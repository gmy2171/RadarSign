package com.sw.radarsign;

/**
 * Created by John on 2018/12/14.
 */

public class CRC_16_1021 {
    /*
	 * CCITT标准CRC16(1021)余数表 CRC16-CCITT ISO HDLC, ITU X.25, x16+x12+x5+1 多项式
	 * 高位在先时生成多项式 Gm=0x11021 低位在先时生成多项式，Gm=0x8408 本例采用高位在先
	 */
    public static int crc16_ccitt_table[] = { 0x0000, 0x1021, 0x2042, 0x3063, 0x4084, 0x50a5, 0x60c6, 0x70e7, 0x8108, 0x9129, 0xa14a,
            0xb16b, 0xc18c, 0xd1ad, 0xe1ce, 0xf1ef, 0x1231, 0x0210, 0x3273, 0x2252, 0x52b5, 0x4294, 0x72f7, 0x62d6, 0x9339, 0x8318, 0xb37b,
            0xa35a, 0xd3bd, 0xc39c, 0xf3ff, 0xe3de, 0x2462, 0x3443, 0x0420, 0x1401, 0x64e6, 0x74c7, 0x44a4, 0x5485, 0xa56a, 0xb54b, 0x8528,
            0x9509, 0xe5ee, 0xf5cf, 0xc5ac, 0xd58d, 0x3653, 0x2672, 0x1611, 0x0630, 0x76d7, 0x66f6, 0x5695, 0x46b4, 0xb75b, 0xa77a, 0x9719,
            0x8738, 0xf7df, 0xe7fe, 0xd79d, 0xc7bc, 0x48c4, 0x58e5, 0x6886, 0x78a7, 0x0840, 0x1861, 0x2802, 0x3823, 0xc9cc, 0xd9ed, 0xe98e,
            0xf9af, 0x8948, 0x9969, 0xa90a, 0xb92b, 0x5af5, 0x4ad4, 0x7ab7, 0x6a96, 0x1a71, 0x0a50, 0x3a33, 0x2a12, 0xdbfd, 0xcbdc, 0xfbbf,
            0xeb9e, 0x9b79, 0x8b58, 0xbb3b, 0xab1a, 0x6ca6, 0x7c87, 0x4ce4, 0x5cc5, 0x2c22, 0x3c03, 0x0c60, 0x1c41, 0xedae, 0xfd8f, 0xcdec,
            0xddcd, 0xad2a, 0xbd0b, 0x8d68, 0x9d49, 0x7e97, 0x6eb6, 0x5ed5, 0x4ef4, 0x3e13, 0x2e32, 0x1e51, 0x0e70, 0xff9f, 0xefbe, 0xdfdd,
            0xcffc, 0xbf1b, 0xaf3a, 0x9f59, 0x8f78, 0x9188, 0x81a9, 0xb1ca, 0xa1eb, 0xd10c, 0xc12d, 0xf14e, 0xe16f, 0x1080, 0x00a1, 0x30c2,
            0x20e3, 0x5004, 0x4025, 0x7046, 0x6067, 0x83b9, 0x9398, 0xa3fb, 0xb3da, 0xc33d, 0xd31c, 0xe37f, 0xf35e, 0x02b1, 0x1290, 0x22f3,
            0x32d2, 0x4235, 0x5214, 0x6277, 0x7256, 0xb5ea, 0xa5cb, 0x95a8, 0x8589, 0xf56e, 0xe54f, 0xd52c, 0xc50d, 0x34e2, 0x24c3, 0x14a0,
            0x0481, 0x7466, 0x6447, 0x5424, 0x4405, 0xa7db, 0xb7fa, 0x8799, 0x97b8, 0xe75f, 0xf77e, 0xc71d, 0xd73c, 0x26d3, 0x36f2, 0x0691,
            0x16b0, 0x6657, 0x7676, 0x4615, 0x5634, 0xd94c, 0xc96d, 0xf90e, 0xe92f, 0x99c8, 0x89e9, 0xb98a, 0xa9ab, 0x5844, 0x4865, 0x7806,
            0x6827, 0x18c0, 0x08e1, 0x3882, 0x28a3, 0xcb7d, 0xdb5c, 0xeb3f, 0xfb1e, 0x8bf9, 0x9bd8, 0xabbb, 0xbb9a, 0x4a75, 0x5a54, 0x6a37,
            0x7a16, 0x0af1, 0x1ad0, 0x2ab3, 0x3a92, 0xfd2e, 0xed0f, 0xdd6c, 0xcd4d, 0xbdaa, 0xad8b, 0x9de8, 0x8dc9, 0x7c26, 0x6c07, 0x5c64,
            0x4c45, 0x3ca2, 0x2c83, 0x1ce0, 0x0cc1, 0xef1f, 0xff3e, 0xcf5d, 0xdf7c, 0xaf9b, 0xbfba, 0x8fd9, 0x9ff8, 0x6e17, 0x7e36, 0x4e55,
            0x5e74, 0x2e93, 0x3eb2, 0x0ed1, 0x1ef0 };


    /**
     *
     * @param message 校验值
     * @return
     */
    public  int do_crc( byte[] message,int length)
    {
        int crc_reg = 0x0000;
        for (int i = 0; i <length; i++)
            crc_reg = crc16_ccitt_table[(((crc_reg >> 8)&0x0000FFFF) ^ message[i]) & 0x000000FF] ^ ((crc_reg << 8)&0x0000FFFF);
        return crc_reg;
    }

    public  int do_crc(int reg_init, byte[] message) {
        /*
        int crc_reg = reg_init;
        int crcsft = 0x00;
        int crcxor = 0x00;
        int crctbl = 0x00;
        */
        int c=0x00,treat=0x00,bcrc=0x00;
        int warc = 0x00;
        for (int i = 0; i < message.length; i++) {
            c =message[i]&0xFF;
            for (int j= 0;j<8;j++) {
                treat = (c & 0x80)&0xFF;
                c <<= 1;
                bcrc = ((warc >>8) & 0x80)&0xFF;
                warc = (warc<<1)&0xFFFF;
                if(treat != bcrc)
                {
                    warc = (warc^0x1021)&0xFFFF;
                }
            }
            /*
            crcsft = (crc_reg >> 8);
            crcxor = (crc_reg ^ message[i]) & 0xff;
            crctbl = crc16_ccitt_table[crcxor];
            crc_reg = crcsft ^ crctbl;
            */
        }
        return warc;
    }



    public static short fcstab[]= {
            (short)0x0000,(short)0x1189,(short)0x2312,(short)0x329b,(short)0x4624,(short)0x57ad,(short)0x6536,(short)0x74bf,(short)0x8c48,(short)0x9dc1,(short) 0xaf5a,(short)0xbed3,
            (short)0xca6c,(short)0xdbe5,(short)0xe97e,(short)0xf8f7,(short)0x1081, (short)0x0108,(short)0x3393,(short)0x221a,(short) 0x56a5,(short)0x472c,(short)0x75b7,(short)0x643e,
            (short)0x9cc9,(short)0x8d40,(short)0xbfdb,(short)0xae52,(short)0xdaed,(short)0xcb64,(short) 0xf9ff,(short)0xe876,(short)0x2102,(short)0x308b, (short)0x0210,(short)0x1399,
            (short)0x6726,(short)0x76af,(short)0x4434,(short)0x55bd,(short) 0xad4a,(short)0xbcc3,(short)0x8e58,(short)0x9fd1,(short)0xeb6e,(short)0xfae7,(short)0xc87c,(short)0xd9f5,
            (short)0x3183,(short)0x200a,(short) 0x1291, (short)0x0318,(short)0x77a7,(short)0x662e,(short)0x54b5,(short)0x453c,(short)0xbdcb,(short)0xac42,(short)0x9ed9,(short)0x8f50,
            (short) 0xfbef,(short)0xea66,(short)0xd8fd,(short)0xc974,(short)0x4204,(short)0x538d,(short)0x6116,(short)0x709f, (short)0x0420,(short)0x15a9,(short) 0x2732,(short)0x36bb,
            (short)0xce4c,(short)0xdfc5,(short)0xed5e,(short)0xfcd7,(short)0x8868,(short)0x99e1,(short)0xab7a,(short)0xbaf3,(short) 0x5285,(short)0x430c,(short)0x7197,(short)0x601e,
            (short)0x14a1, (short)0x0528,(short)0x37b3,(short)0x263a,(short)0xdecd,(short)0xcf44,(short) 0xfddf,(short)0xec56,(short)0x98e9,(short)0x8960,(short)0xbbfb,(short)0xaa72,
            (short)0x6306,(short)0x728f,(short)0x4014,(short)0x519d,(short) 0x2522,(short)0x34ab, (short)0x0630,(short)0x17b9,(short)0xef4e,(short)0xfec7,(short)0xcc5c,(short)0xddd5,
            (short)0xa96a,(short)0xb8e3,(short) 0x8a78,(short)0x9bf1,(short)0x7387,(short)0x620e,(short)0x5095,(short)0x411c,(short)0x35a3,(short)0x242a,(short)0x16b1, (short)0x0738,
            (short) 0xffcf,(short)0xee46,(short)0xdcdd,(short)0xcd54,(short)0xb9eb,(short)0xa862,(short)0x9af9,(short)0x8b70,(short)0x8408,(short)0x9581,(short) 0xa71a,(short)0xb693,
            (short)0xc22c,(short)0xd3a5,(short)0xe13e,(short)0xf0b7, (short)0x0840,(short)0x19c,(short)0x2b52,(short)0x3adb,(short) 0x4e64,(short)0x5fed,(short)0x6d76,(short)0x7cff,
            (short)0x9489,(short)0x8500,(short)0xb79b,(short)0xa612,(short)0xd2ad,(short)0xc324,(short) 0xf1bf,(short)0xe036,(short)0x18c1, (short)0x0948,(short)0x3bd3,(short)0x2a5a,
            (short)0x5ee5,(short)0x4f6c,(short)0x7df7,(short)0x6c7e,(short) 0xa50a,(short)0xb483,(short)0x8618,(short)0x9791,(short)0xe32e,(short)0xf2a7,(short)0xc03c,(short)0xd1b5,
            (short)0x2942,(short)0x38cb,(short)0x0a50,(short)0x1bd9,(short)0x6f66,(short)0x7eef,(short)0x4c74,(short)0x5dfd,(short)0xb58b,(short)0xa402,(short)0x9699,(short)0x8710,
            (short) 0xf3af,(short)0xe226,(short)0xd0bd,(short)0xc134,(short)0x39c3,(short)0x284a,(short)0x1ad1, (short)0x0b58,(short)0x7fe7,(short)0x6e6e,(short) 0x5cf5,(short)0x4d7c,
            (short)0xc60c,(short)0xd785,(short)0xe51e,(short)0xf497,(short)0x8028,(short)0x91a1,(short)0xa33a,(short)0xb2b3,(short) 0x4a44,(short)0x5bcd,(short)0x6956,(short)0x78df,
            (short)0x0c60,(short)0x1de9,(short)0x2f72,(short)0x3efb,(short)0xd68d,(short)0xc704,(short) 0xf59f,(short)0xe416,(short)0x90a9,(short)0x8120,(short)0xb3bb,(short)0xa232,
            (short)0x5ac5,(short)0x4b4c,(short)0x79d7,(short)0x685e,(short) 0x1ce1, (short)0x0d68,(short)0x3ff3,(short)0x2e7a,(short)0xe70e,(short)0xf687,(short)0xc41c,(short)0xd595,
            (short)0xa12a,(short)0xb0a3,(short) 0x8238,(short)0x93b1,(short)0x6b46,(short)0x7acf,(short)0x4854,(short)0x59dd,(short)0x2d62,(short)0x3ceb, (short)0x0e70,(short)0x1ff9,
            (short) 0xf78f,(short)0xe606,(short)0xd49d,(short)0xc514,(short)0xb1ab,(short)0xa022,(short)0x92b9,(short)0x8330,(short)0x7bc7,(short)0x6a4e,(short) 0x58d5,(short)0x495c,
            (short)0x3de3,(short)0x2c6a,(short)0x1ef1,(short)0x0f78
    };

    public short Pub_CalcCRC(byte[] cp,int len)
    {
        short fcs = (short)0xffff;
        short t0fcs ,t1fcs,t2fcs;
        for(short i=0;i<len;i++) {
            t0fcs = (short)(fcs >> 8);
            t1fcs = (short)(fcs ^ cp[i]);
            t2fcs = (short) (t1fcs & 0xff);
            fcs = (short) (t0fcs ^ fcstab[t2fcs]);
            //fcs = (fcs >> 8) ^ fcstab[(fcs ^ cp[i]) & 0xff];
        }
        return fcs;
    }

}
